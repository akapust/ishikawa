<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Turtle Diagramm – Prozessanalyse</title>

  <!-- html2canvas (für PNG-Export) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root{
      --blue:#1155b2;
      --dark:#09387a;
      --light-bg:#f8fafc;
      --border:#d1d9e6;
      --muted:#64748b;
      --text:#27304d;
      --note:#fff9c4;
      --shadow: 0 4px 12px rgba(0,0,0,.10);
      --radius:4px;

      /* box accents */
      --in-bg:#eff6ff;   --in-b:#3b82f6;   /* Inputs */
      --out-bg:#ecfdf5;  --out-b:#22c55e;  /* Outputs */
      --people-bg:#fff7ed; --people-b:#f97316; /* People */
      --res-bg:#f5f3ff;  --res-b:#8b5cf6;  /* Resources */
      --meth-bg:#fefce8; --meth-b:#eab308; /* Methods */
      --kpi-bg:#fff1f2;  --kpi-b:#ef4444;  /* KPIs */
      --risk-bg:#f1f5f9; --risk-b:#0f172a; /* Risks */
      --doc-bg:#f0fdf4;  --doc-b:#16a34a;  /* Docs */
    }

    body{ margin:0; background:#fff; }

    .turtle-app{
      max-width:1100px;
      margin:20px auto;
      padding:0 12px;
      font-family:'Segoe UI', Roboto, sans-serif;
      color:var(--text);
    }
    .turtle-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    /* Intro */
    .tool-intro{ padding:22px 25px; border-bottom:3px solid var(--blue); background:var(--light-bg); }
    .tool-intro-top{ display:flex; align-items:flex-start; justify-content:space-between; gap:15px; flex-wrap:wrap; }
    .tool-title{ margin:0; color:var(--dark); font-size:20px; text-transform:uppercase; }
    .tool-sub{ margin:6px 0 0; font-size:13px; color:var(--muted); }

    .tool-grid{ margin-top:16px; display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .tool-box{ background:#fff; border:1px solid var(--border); border-radius:var(--radius); padding:12px 14px; }
    .tool-box h3{ margin:0 0 6px 0; font-size:13px; color:var(--dark); text-transform:uppercase; }
    .tool-box p, .tool-box ol{ margin:0; font-size:13px; color:#334155; }
    .tool-box ol{ padding-left:18px; }
    .tool-privacy{ border-left:3px solid var(--blue); }

    .tool-box a{ color:var(--blue); text-decoration:none; font-weight:800; }
    .tool-box a:hover{ text-decoration:underline; }

    /* Buttons */
    .i-btn{
      padding:10px 18px;
      font-size:13px;
      font-weight:bold;
      border-radius:var(--radius);
      cursor:pointer;
      border:1px solid var(--border);
      background:#fff;
      text-transform:uppercase;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      user-select:none;
      gap:8px;
    }
    .i-btn.primary{ background:var(--blue); color:#fff; border-color:var(--blue); }
    .i-btn.danger{ color:#e53e3e; border-color: rgba(229,62,62,.35); }
    .i-btn:hover{ border-color: rgba(17,85,178,.45); }
    .i-btn.primary:hover{ background:var(--dark); border-color:var(--dark); }
    .i-btn.danger:hover{ border-color: rgba(229,62,62,.55); background: rgba(229,62,62,.06); }

    .lang-switch{ display:flex; gap:8px; align-items:center; }
    .lang-switch .i-btn{ padding:8px 12px; font-size:12px; }

    /* Body */
    .turtle-body{ padding:25px; }
    .turtle-drawing-area{ padding:22px; background:#fff; border:1px solid #edf2f7; position:relative; }

    /* Header/meta inside capture */
    .turtle-headerbar{
      display:grid;
      grid-template-columns: 1.2fr .8fr .6fr .5fr;
      gap:12px;
      padding-bottom:14px;
      margin-bottom:14px;
      border-bottom:1px solid #eef2f7;
      align-items:start;
    }
    .turtle-field{ display:flex; flex-direction:column; gap:6px; }
    .turtle-field label{
      font-size:12px;
      color:var(--muted);
      text-transform:uppercase;
      font-weight:800;
      letter-spacing:.2px;
    }
    .turtle-input, .turtle-textarea{
      width:100%;
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:10px;
      font-family:inherit;
      font-size:13px;
      outline:none;
      background:#fff;
    }
    .turtle-textarea{ min-height:62px; resize:vertical; grid-column: 1 / span 2; }
    .turtle-input:focus, .turtle-textarea:focus{
      border-color: rgba(17,85,178,.7);
      box-shadow: 0 0 0 3px rgba(17,85,178,.12);
    }

    .turtle-axis{
      display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;
      gap:10px; margin: 6px 0 12px;
      font-size:12px; color:var(--muted);
    }
    .turtle-axis strong{ color:var(--dark); }

    /* Diagram grid (3x3) */
    .turtle-grid{
      display:grid;
      grid-template-columns: 1fr 1.15fr 1fr;
      grid-template-rows: auto auto auto;
      gap:12px;
      align-items:stretch;
    }

    .tbox{
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:12px 14px;
      background:#fff;
      display:flex;
      flex-direction:column;
      min-height:170px;
    }
    .tbox.center{
      min-height:240px;
      border:2px solid rgba(17,85,178,.35);
      background: radial-gradient(circle at center, rgba(17,85,178,.06) 0%, transparent 70%);
    }

    .tbox-title{
      display:flex; justify-content:space-between; align-items:baseline; gap:10px;
      margin:0 0 10px 0;
      font-size:13px;
      font-weight:900;
      text-transform:uppercase;
      color:var(--dark);
      padding-bottom:8px;
      border-bottom:1px solid rgba(0,0,0,.06);
    }
    .tbox-title small{ font-weight:800; color:var(--muted); text-transform:none; }

    .accent-in{ background:var(--in-bg); border-left:4px solid var(--in-b); }
    .accent-out{ background:var(--out-bg); border-left:4px solid var(--out-b); }
    .accent-people{ background:var(--people-bg); border-left:4px solid var(--people-b); }
    .accent-res{ background:var(--res-bg); border-left:4px solid var(--res-b); }
    .accent-meth{ background:var(--meth-bg); border-left:4px solid var(--meth-b); }
    .accent-kpi{ background:var(--kpi-bg); border-left:4px solid var(--kpi-b); }
    .accent-risk{ background:var(--risk-bg); border-left:4px solid var(--risk-b); }
    .accent-doc{ background:var(--doc-bg); border-left:4px solid var(--doc-b); }

    .notes{ display:flex; flex-direction:column; gap:6px; flex-grow:1; }
    .note-item{
      background:var(--note);
      padding:6px;
      font-size:12px;
      border-left:3px solid #fbc02d;
      box-shadow:2px 2px 4px rgba(0,0,0,0.05);
      position:relative;
      padding-right:30px;
      border-radius:3px;
    }
    .note-item textarea{
      width:100%;
      border:none;
      background:transparent;
      resize:none;
      font-family:inherit;
      outline:none;
      font-size:12px;
    }
    .note-delete{
      position:absolute;
      top:4px; right:6px;
      border:none;
      background:transparent;
      cursor:pointer;
      font-size:18px;
      line-height:1;
      color:#94a3b8;
    }
    .note-delete:hover{ color:#e53e3e; }

    .btn-add{
      background:none;
      border:1px dashed #cbd5e1;
      color:#94a3b8;
      cursor:pointer;
      font-size:11px;
      margin-top:10px;
      padding:6px;
      border-radius:var(--radius);
      text-transform:uppercase;
      font-weight:900;
    }
    .btn-add:hover{ background: rgba(255,255,255,0.7); color:var(--blue); border-color:var(--blue); }

    /* Center process */
    .center-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top: 6px;
    }
    .center-grid .turtle-field label{ font-size:11px; }
    .center-grid .turtle-input{ padding:9px; font-size:13px; }
    .center-grid .full{ grid-column: 1 / -1; }
    .center-desc{ min-height:96px; }

    /* Measures (Action plan) */
    .measures-section{
      margin-top: 16px;
      border-top: 2px solid var(--blue);
      padding-top: 14px;
    }
    .measures-head{
      display:flex;
      justify-content: space-between;
      align-items:flex-start;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .measures-title{
      margin:0;
      font-size:13px;
      font-weight:900;
      color: var(--dark);
      text-transform: uppercase;
      letter-spacing: .2px;
    }
    .measures-sub{
      margin:4px 0 0;
      font-size:13px;
      color: var(--muted);
    }
    .measures-actions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

    .measure-list{ display:flex; flex-direction:column; gap:8px; }
    .measure-item{
      background:#fff;
      border:1px solid #e2e8f0;
      border-radius: var(--radius);
      padding:10px;
      position:relative;
      display:grid;
      grid-template-columns: 1.2fr .4fr .5fr;
      gap:10px;
      align-items:start;
      padding-right: 34px;
    }
    .measure-item textarea{
      width:100%;
      border:none;
      resize:vertical;
      min-height:46px;
      font-family: inherit;
      font-size:13px;
      outline:none;
      background:transparent;
    }
    .measure-item input{
      width:100%;
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:8px;
      font-family: inherit;
      font-size:13px;
      outline:none;
      background:#fff;
    }
    .measure-item input:focus{
      border-color: rgba(17,85,178,.7);
      box-shadow: 0 0 0 3px rgba(17,85,178,.12);
    }
    .measure-delete{
      position:absolute;
      top:8px; right:10px;
      border:none;
      background:transparent;
      cursor:pointer;
      font-size:18px;
      line-height:1;
      color:#94a3b8;
    }
    .measure-delete:hover{ color:#e53e3e; }

    @media (max-width: 980px){
      .measure-item{ grid-template-columns: 1fr; }
    }

    /* Actions */
    .turtle-actions{
      margin-top:18px;
      padding-top:16px;
      border-top:2px solid var(--blue);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    /* Footer */
    .turtle-footer{
      padding:12px 25px;
      background:var(--light-bg);
      border-top:1px solid var(--border);
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    /* More section */
    .tool-more{ margin-top:22px; padding-top:18px; border-top:2px solid var(--blue); }
    .more-title{ margin:0 0 6px 0; font-size:13px; color:var(--dark); text-transform:uppercase; }
    .more-sub{ margin:0 0 10px 0; font-size:13px; color:var(--muted); }
    .more-list{ margin:8px 0 0; padding-left:18px; font-size:13px; color:#334155; }
    .more-list li{ margin:4px 0; }

    @media (max-width: 980px){
      .turtle-headerbar{ grid-template-columns: 1fr 1fr; }
      .turtle-textarea{ grid-column: 1 / -1; }
      .turtle-grid{ grid-template-columns: 1fr; }
      .tbox.center{ order: 1; }
      .tool-grid{ grid-template-columns: 1fr; }
      .tool-intro, .turtle-body, .turtle-footer{ padding-left:16px; padding-right:16px; }
    }

    /* Print */
    @media print{
      .turtle-actions, .lang-switch, .tool-more a{ display:none !important; }
      .turtle-card{ box-shadow:none !important; border:none !important; }
      .turtle-app{ margin:0 !important; padding:0 !important; }
      .turtle-body{ padding:0 !important; }
      .turtle-drawing-area{ border:none !important; }
    }
  </style>
</head>

<body>
  <div id="qm-turtle-app" class="turtle-app">
    <section class="turtle-card">

      <!-- Intro -->
      <section class="tool-intro">
        <div class="tool-intro-top">
          <div>
            <h2 class="tool-title" data-i18n="title">Turtle Diagramm – Prozessanalyse</h2>
            <p class="tool-sub" data-i18n="subtitle">Prozesse strukturiert beschreiben: Inputs/Outputs, Rollen, Ressourcen, Methoden und Kennzahlen.</p>
          </div>

          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
            <div class="lang-switch" aria-label="Language switch">
              <button type="button" class="i-btn" id="btnLangDE">DE</button>
              <button type="button" class="i-btn" id="btnLangEN">EN</button>
            </div>
            <a class="i-btn" href="https://tools.quality.de/" data-i18n="backHome">Zurück zur Startseite</a>
          </div>
        </div>

        <div class="tool-grid">
          <div class="tool-box">
            <h3 data-i18n="boxToolNameTitle">Name Tool</h3>
            <p data-i18n="boxToolNameText">Turtle Diagramm – Prozessübersicht (Inputs/Outputs + 6 Fragen)</p>
          </div>

          <div class="tool-box">
            <h3 data-i18n="boxGoalTitle">Ziel</h3>
            <p data-i18n="boxGoalText">Eine kompakte Prozessbeschreibung erstellen – ideal für QM-Dokumentation, Audits und Verbesserungsarbeit.</p>
          </div>

          <div class="tool-box">
            <h3 data-i18n="boxHowTitle">So benutzt du das Tool</h3>
            <ol>
              <li data-i18n="step1">Prozessdaten eintragen (Name, Scope, Owner, Datum).</li>
              <li data-i18n="step2">Rund um den Prozess Stichpunkte ergänzen (Inputs/Outputs, Rollen, Ressourcen, Methoden, KPIs).</li>
              <li data-i18n="step3">Maßnahmen ableiten (mit Termin) und Export als PNG, Print oder JSON speichern.</li>
            </ol>
          </div>

          <div class="tool-box tool-privacy">
            <h3 data-i18n="boxPrivacyTitle">Datenschutz</h3>
            <p data-i18n="boxPrivacyText">Dieses Tool arbeitet vollständig im Browser. Es werden keine Daten auf einem Server gespeichert. Zugriff hat nur die Person, die die Datei lokal speichert bzw. lädt.</p>
          </div>
        </div>
      </section>

      <div class="turtle-body">
        <div id="capture-area" class="turtle-drawing-area">

          <!-- Header/meta -->
          <div class="turtle-headerbar">
            <div class="turtle-field">
              <label for="procName" data-i18n="procNameLabel">Prozess</label>
              <input id="procName" class="turtle-input" type="text" data-i18n-placeholder="procNamePh" placeholder="z.B. Wareneingang prüfen" />
            </div>

            <div class="turtle-field">
              <label for="procOwner" data-i18n="ownerLabel">Owner / Verantwortlich</label>
              <input id="procOwner" class="turtle-input" type="text" data-i18n-placeholder="ownerPh" placeholder="z.B. QM / Einkauf" />
            </div>

            <div class="turtle-field">
              <label for="procDate" data-i18n="dateLabel">Datum</label>
              <input id="procDate" class="turtle-input" type="date" />
            </div>

            <div class="turtle-field">
              <label for="procVersion" data-i18n="versionLabel">Version</label>
              <input id="procVersion" class="turtle-input" type="text" data-i18n-placeholder="versionPh" placeholder="z.B. 1.0" />
            </div>

            <div class="turtle-field" style="grid-column:1 / -1;">
              <label for="procScope" data-i18n="scopeLabel">Thema / Ziel / Scope</label>
              <textarea id="procScope" class="turtle-textarea" data-i18n-placeholder="scopePh" placeholder="Kurz: Worum geht es, Grenzen, Ziel, Rahmenbedingungen ..."></textarea>
            </div>
          </div>

          <div class="turtle-axis">
            <div><strong data-i18n="axisCoreStrong">Kern</strong><span data-i18n="axisCoreText">: Prozess im Zentrum</span></div>
            <div><strong data-i18n="axisAroundStrong">Rundherum</strong><span data-i18n="axisAroundText">: Inputs/Outputs + Rollen/Methoden/Ressourcen/KPIs</span></div>
          </div>

          <!-- Turtle grid -->
          <div class="turtle-grid">
            <!-- row 1 -->
            <div class="tbox accent-people" data-area="PEOPLE">
              <div class="tbox-title"><span data-i18n="peopleTitle">Mit wem?</span> <small data-i18n="peopleSub">Rollen & Kompetenzen</small></div>
              <div class="notes" id="notes-PEOPLE"></div>
              <button class="btn-add" type="button" onclick="addItem('PEOPLE')" data-i18n="addItem">+ Eintrag</button>
            </div>

            <div class="tbox accent-meth" data-area="METHODS">
              <div class="tbox-title"><span data-i18n="methodsTitle">Wie?</span> <small data-i18n="methodsSub">Ablauf & Methoden</small></div>
              <div class="notes" id="notes-METHODS"></div>
              <button class="btn-add" type="button" onclick="addItem('METHODS')" data-i18n="addItem">+ Eintrag</button>
            </div>

            <div class="tbox accent-res" data-area="RESOURCES">
              <div class="tbox-title"><span data-i18n="resourcesTitle">Womit?</span> <small data-i18n="resourcesSub">Ressourcen & Infrastruktur</small></div>
              <div class="notes" id="notes-RESOURCES"></div>
              <button class="btn-add" type="button" onclick="addItem('RESOURCES')" data-i18n="addItem">+ Eintrag</button>
            </div>

            <!-- row 2 -->
            <div class="tbox accent-in" data-area="INPUTS">
              <div class="tbox-title"><span data-i18n="inputsTitle">Inputs</span> <small data-i18n="inputsSub">Was kommt rein?</small></div>
              <div class="notes" id="notes-INPUTS"></div>
              <button class="btn-add" type="button" onclick="addItem('INPUTS')" data-i18n="addItem">+ Eintrag</button>
            </div>

            <div class="tbox center" data-area="PROCESS">
              <div class="tbox-title"><span data-i18n="processTitle">Prozess im Zentrum</span> <small data-i18n="processSub">Zweck & Schnittstellen</small></div>

              <div class="center-grid">
                <div class="turtle-field full">
                  <label for="procPurpose" data-i18n="purposeLabel">Zweck / Ergebnis</label>
                  <textarea id="procPurpose" class="turtle-textarea center-desc" data-i18n-placeholder="purposePh" placeholder="Was ist der Zweck des Prozesses? Was ist das gewünschte Ergebnis?"></textarea>
                </div>

                <div class="turtle-field">
                  <label for="procStart" data-i18n="startLabel">Start (Trigger)</label>
                  <input id="procStart" class="turtle-input" type="text" data-i18n-placeholder="startPh" placeholder="z.B. Bestellung/Wareneingang" />
                </div>
                <div class="turtle-field">
                  <label for="procEnd" data-i18n="endLabel">Ende (Output erreicht)</label>
                  <input id="procEnd" class="turtle-input" type="text" data-i18n-placeholder="endPh" placeholder="z.B. Freigabe / Dokumentation" />
                </div>
              </div>
            </div>

            <div class="tbox accent-out" data-area="OUTPUTS">
              <div class="tbox-title"><span data-i18n="outputsTitle">Outputs</span> <small data-i18n="outputsSub">Was kommt raus?</small></div>
              <div class="notes" id="notes-OUTPUTS"></div>
              <button class="btn-add" type="button" onclick="addItem('OUTPUTS')" data-i18n="addItem">+ Eintrag</button>
            </div>

            <!-- row 3 -->
            <div class="tbox accent-risk" data-area="RISKS">
              <div class="tbox-title"><span data-i18n="risksTitle">Risiken</span> <small data-i18n="risksSub">Fehlerquellen / Barrieren</small></div>
              <div class="notes" id="notes-RISKS"></div>
              <button class="btn-add" type="button" onclick="addItem('RISKS')" data-i18n="addItem">+ Eintrag</button>
            </div>

            <div class="tbox accent-kpi" data-area="KPIS">
              <div class="tbox-title"><span data-i18n="kpiTitle">Wie gemessen?</span> <small data-i18n="kpiSub">KPIs & Nachweise</small></div>
              <div class="notes" id="notes-KPIS"></div>
              <button class="btn-add" type="button" onclick="addItem('KPIS')" data-i18n="addItem">+ Eintrag</button>
            </div>

            <div class="tbox accent-doc" data-area="DOCS">
              <div class="tbox-title"><span data-i18n="docsTitle">Dokumente</span> <small data-i18n="docsSub">SOPs / Records</small></div>
              <div class="notes" id="notes-DOCS"></div>
              <button class="btn-add" type="button" onclick="addItem('DOCS')" data-i18n="addItem">+ Eintrag</button>
            </div>
          </div>

          <!-- Measures -->
          <section class="measures-section" aria-label="Maßnahmen">
            <div class="measures-head">
              <div>
                <h3 class="measures-title" data-i18n="measuresTitle">Ableitung von Maßnahmen</h3>
                <p class="measures-sub" data-i18n="measuresSub">Formuliere Maßnahmen (Was? Wer? Bis wann?) und setze einen Termin.</p>
              </div>
              <div class="measures-actions">
                <button type="button" class="i-btn" id="btnFromRisks" data-i18n="btnFromRisks">Aus Risiken übernehmen</button>
                <button type="button" class="i-btn primary" id="btnAddMeasure" data-i18n="btnAddMeasure">+ Maßnahme</button>
              </div>
            </div>

            <div class="measure-list" id="measuresList"></div>
          </section>

        </div>

        <!-- Actions -->
        <div class="turtle-actions">
          <a class="i-btn" href="https://tools.quality.de/" data-i18n="backHome">Zurück zur Startseite</a>
          <button type="button" class="i-btn primary" id="btnExport" data-i18n="btnExport">Bild exportieren (PNG)</button>
          <button type="button" class="i-btn" id="btnPrint" data-i18n="btnPrint">Drucken</button>
          <button type="button" class="i-btn" id="btnSave" data-i18n="btnSave">JSON Speichern</button>
          <label class="i-btn" style="cursor:pointer">
            <span data-i18n="btnUpload">Upload</span>
            <input type="file" id="btnLoad" hidden>
          </label>
          <button type="button" class="i-btn danger" id="btnReset" data-i18n="btnReset">Reset</button>
        </div>

        <!-- More -->
        <section class="tool-more">
          <h3 class="more-title" data-i18n="moreTitle">Weiterführende Infos</h3>
          <p class="more-sub" data-i18n="moreSub">Grundlagen & passende Weiterbildungen (öffnet in neuem Tab).</p>

          <div class="tool-grid">
            <div class="tool-box">
              <h3 data-i18n="lexTitle">Lexikon</h3>
              <p data-i18n="lexText">Hintergrund, Nutzen & Anwendung von Prozess-Tools im QM.</p>
              <p style="margin-top:8px;">
                <a href="https://www.quality.de/lexikon/" target="_blank" rel="noopener" data-i18n="lexLink">Zum Lexikon</a>
              </p>
            </div>

            <div class="tool-box">
              <h3 data-i18n="trainTitle">Ausbildungen &amp; Seminare</h3>
              <p data-i18n="trainText">Vertiefe deine Methodenkompetenz im Qualitätsmanagement:</p>
              <ul class="more-list">
                <li><a href="https://www.quality.de/weiterbildung/qualitaetsmanagement/" target="_blank" rel="noopener" data-i18n="trainQm">Qualitätsmanagement</a></li>
                <li><a href="https://www.quality.de/weiterbildung/opex-seminare-ausbildungen/" target="_blank" rel="noopener" data-i18n="trainOpex">OPEX Seminare &amp; Ausbildungen</a></li>
                <li><a href="https://www.quality.de/weiterbildung/kvp/" target="_blank" rel="noopener" data-i18n="trainKvp">KVP Seminare</a></li>
              </ul>
            </div>
          </div>
        </section>

      </div>

      <!-- Footer -->
      <footer class="turtle-footer">
        <div>© <span id="copyrightYear"></span></div>
        <div><span data-i18n="poweredBy">Powered by</span> Quality Services &amp; Wissen GmbH</div>
      </footer>

    </section>
  </div>

  <script>
    /* ========= i18n (DE/EN) ========= */
    const I18N = {
      de: {
        title: "Turtle Diagramm – Prozessanalyse",
        subtitle: "Prozesse strukturiert beschreiben: Inputs/Outputs, Rollen, Ressourcen, Methoden und Kennzahlen.",
        backHome: "Zurück zur Startseite",

        boxToolNameTitle: "Name Tool",
        boxToolNameText: "Turtle Diagramm – Prozessübersicht (Inputs/Outputs + 6 Fragen)",
        boxGoalTitle: "Ziel",
        boxGoalText: "Eine kompakte Prozessbeschreibung erstellen – ideal für QM-Dokumentation, Audits und Verbesserungsarbeit.",
        boxHowTitle: "So benutzt du das Tool",
        step1: "Prozessdaten eintragen (Name, Scope, Owner, Datum).",
        step2: "Rund um den Prozess Stichpunkte ergänzen (Inputs/Outputs, Rollen, Ressourcen, Methoden, KPIs).",
        step3: "Maßnahmen ableiten (mit Termin) und Export als PNG, Print oder JSON speichern.",
        boxPrivacyTitle: "Datenschutz",
        boxPrivacyText: "Dieses Tool arbeitet vollständig im Browser. Es werden keine Daten auf einem Server gespeichert. Zugriff hat nur die Person, die die Datei lokal speichert bzw. lädt.",

        procNameLabel: "Prozess",
        procNamePh: "z.B. Wareneingang prüfen",
        ownerLabel: "Owner / Verantwortlich",
        ownerPh: "z.B. QM / Einkauf",
        dateLabel: "Datum",
        versionLabel: "Version",
        versionPh: "z.B. 1.0",
        scopeLabel: "Thema / Ziel / Scope",
        scopePh: "Kurz: Worum geht es, Grenzen, Ziel, Rahmenbedingungen ...",

        axisCoreStrong: "Kern",
        axisCoreText: ": Prozess im Zentrum",
        axisAroundStrong: "Rundherum",
        axisAroundText: ": Inputs/Outputs + Rollen/Methoden/Ressourcen/KPIs",

        peopleTitle: "Mit wem?",
        peopleSub: "Rollen & Kompetenzen",
        resourcesTitle: "Womit?",
        resourcesSub: "Ressourcen & Infrastruktur",
        methodsTitle: "Wie?",
        methodsSub: "Ablauf & Methoden",
        kpiTitle: "Wie gemessen?",
        kpiSub: "KPIs & Nachweise",
        inputsTitle: "Inputs",
        inputsSub: "Was kommt rein?",
        outputsTitle: "Outputs",
        outputsSub: "Was kommt raus?",
        risksTitle: "Risiken",
        risksSub: "Fehlerquellen / Barrieren",
        docsTitle: "Dokumente",
        docsSub: "SOPs / Records",

        processTitle: "Prozess im Zentrum",
        processSub: "Zweck & Schnittstellen",
        purposeLabel: "Zweck / Ergebnis",
        purposePh: "Was ist der Zweck des Prozesses? Was ist das gewünschte Ergebnis?",
        startLabel: "Start (Trigger)",
        startPh: "z.B. Bestellung/Wareneingang",
        endLabel: "Ende (Output erreicht)",
        endPh: "z.B. Freigabe / Dokumentation",

        addItem: "+ Eintrag",
        itemPlaceholder: "Stichpunkt eingeben...",
        deleteEntry: "Eintrag löschen",

        measuresTitle: "Ableitung von Maßnahmen",
        measuresSub: "Formuliere Maßnahmen (Was? Wer? Bis wann?) und setze einen Termin.",
        btnAddMeasure: "+ Maßnahme",
        btnFromRisks: "Aus Risiken übernehmen",
        measurePlaceholder: "Maßnahme formulieren (Was? Wirkung? …)",
        dueLabel: "Termin",
        ownerShort: "Owner",
        deleteMeasure: "Maßnahme löschen",

        btnExport: "Bild exportieren (PNG)",
        btnPrint: "Drucken",
        btnSave: "JSON Speichern",
        btnUpload: "Upload",
        btnReset: "Reset",
        confirmReset: "Alles löschen?",

        moreTitle: "Weiterführende Infos",
        moreSub: "Grundlagen & passende Weiterbildungen (öffnet in neuem Tab).",
        lexTitle: "Lexikon",
        lexText: "Hintergrund, Nutzen & Anwendung von Prozess-Tools im QM.",
        lexLink: "Zum Lexikon",
        trainTitle: "Ausbildungen & Seminare",
        trainText: "Vertiefe deine Methodenkompetenz im Qualitätsmanagement:",
        trainQm: "Qualitätsmanagement",
        trainOpex: "OPEX Seminare & Ausbildungen",
        trainKvp: "KVP Seminare",

        poweredBy: "Powered by",

        pngName: "Quality_Turtle.png",
        jsonName: "Turtle_Export.json",
        loadError: "Fehler beim Laden der Datei."
      },

      en: {
        title: "Turtle Diagram – Process Analysis",
        subtitle: "Describe processes in a structured way: inputs/outputs, roles, resources, methods and KPIs.",
        backHome: "Back to home",

        boxToolNameTitle: "Tool name",
        boxToolNameText: "Turtle Diagram – Process overview (Inputs/Outputs + 6 questions)",
        boxGoalTitle: "Goal",
        boxGoalText: "Create a compact process description – ideal for QM documentation, audits and continuous improvement.",
        boxHowTitle: "How to use this tool",
        step1: "Enter process data (name, scope, owner, date).",
        step2: "Add bullet points around the process (inputs/outputs, people, resources, methods, KPIs).",
        step3: "Derive actions (with due date) and export as PNG, print, or save/load JSON.",
        boxPrivacyTitle: "Privacy",
        boxPrivacyText: "This tool runs entirely in your browser. No data is stored on any server. Only the person who saves/loads files locally has access.",

        procNameLabel: "Process",
        procNamePh: "e.g. Incoming goods inspection",
        ownerLabel: "Owner / Responsible",
        ownerPh: "e.g. QA / Purchasing",
        dateLabel: "Date",
        versionLabel: "Version",
        versionPh: "e.g. 1.0",
        scopeLabel: "Topic / Goal / Scope",
        scopePh: "Short: what it's about, boundaries, goal, constraints ...",

        axisCoreStrong: "Core",
        axisCoreText: ": the process in the center",
        axisAroundStrong: "Around it",
        axisAroundText: ": inputs/outputs + people/methods/resources/KPIs",

        peopleTitle: "With whom?",
        peopleSub: "Roles & competence",
        resourcesTitle: "With what?",
        resourcesSub: "Resources & infrastructure",
        methodsTitle: "How?",
        methodsSub: "Flow & methods",
        kpiTitle: "How measured?",
        kpiSub: "KPIs & evidence",
        inputsTitle: "Inputs",
        inputsSub: "What comes in?",
        outputsTitle: "Outputs",
        outputsSub: "What comes out?",
        risksTitle: "Risks",
        risksSub: "Failure modes / barriers",
        docsTitle: "Documents",
        docsSub: "SOPs / records",

        processTitle: "Process in the center",
        processSub: "Purpose & interfaces",
        purposeLabel: "Purpose / Result",
        purposePh: "What is the purpose of the process? What result is expected?",
        startLabel: "Start (trigger)",
        startPh: "e.g. order / goods receipt",
        endLabel: "End (output achieved)",
        endPh: "e.g. release / documentation",

        addItem: "+ Item",
        itemPlaceholder: "Enter bullet point...",
        deleteEntry: "Delete entry",

        measuresTitle: "Deriving actions",
        measuresSub: "Write actions (What? Who? By when?) and set a due date.",
        btnAddMeasure: "+ Action",
        btnFromRisks: "Create from risks",
        measurePlaceholder: "Describe action (what? expected effect? …)",
        dueLabel: "Due date",
        ownerShort: "Owner",
        deleteMeasure: "Delete action",

        btnExport: "Export image (PNG)",
        btnPrint: "Print",
        btnSave: "Save JSON",
        btnUpload: "Upload",
        btnReset: "Reset",
        confirmReset: "Delete everything?",

        moreTitle: "More information",
        moreSub: "Basics & relevant training (opens in a new tab).",
        lexTitle: "Glossary",
        lexText: "Background, benefits & use of process tools in QM.",
        lexLink: "Open glossary",
        trainTitle: "Training & courses",
        trainText: "Deepen your method skills in quality management:",
        trainQm: "Quality management",
        trainOpex: "OPEX courses & programs",
        trainKvp: "CIP (KVP) seminars",

        poweredBy: "Powered by",

        pngName: "Quality_Turtle.png",
        jsonName: "Turtle_Export.json",
        loadError: "Error loading the file."
      }
    };

    const STORAGE_KEY = "qm_turtle_state_v2";
    let currentLang = (localStorage.getItem("qmLang") || (navigator.language && navigator.language.toLowerCase().startsWith("de") ? "de" : "en"));

    function t(key){ return (I18N[currentLang] && I18N[currentLang][key]) ? I18N[currentLang][key] : key; }

    function applyI18n(){
      document.documentElement.lang = currentLang;

      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key = el.dataset.i18n;
        el.textContent = t(key);
      });

      document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
        const key = el.dataset.i18nPlaceholder;
        el.placeholder = t(key);
      });

      // dynamic notes
      document.querySelectorAll(".note-item textarea").forEach(ta=>{
        ta.placeholder = t("itemPlaceholder");
      });
      document.querySelectorAll(".note-delete").forEach(btn=>{
        btn.title = t("deleteEntry");
        btn.setAttribute("aria-label", t("deleteEntry"));
      });

      // measures
      document.querySelectorAll(".measure-item textarea").forEach(ta=>{
        ta.placeholder = t("measurePlaceholder");
      });
      document.querySelectorAll(".measure-delete").forEach(btn=>{
        btn.title = t("deleteMeasure");
        btn.setAttribute("aria-label", t("deleteMeasure"));
      });

      // Active button style
      const deBtn = document.getElementById("btnLangDE");
      const enBtn = document.getElementById("btnLangEN");
      if(deBtn && enBtn){
        deBtn.classList.toggle("primary", currentLang === "de");
        enBtn.classList.toggle("primary", currentLang === "en");
      }
    }

    function setLanguage(lang){
      currentLang = (lang==="de" || lang==="en") ? lang : "de";
      localStorage.setItem("qmLang", currentLang);
      localStorage.setItem("qmLang", currentLang);
      applyI18n();
      persist();
    }

    function addItem(area, val=""){
      const container = document.getElementById(`notes-${area}`);
      const div = document.createElement("div");
      div.className = "note-item";

      const del = document.createElement("button");
      del.type = "button";
      del.className = "note-delete";
      del.title = t("deleteEntry");
      del.setAttribute("aria-label", t("deleteEntry"));
      del.innerHTML = "&times;";
      del.onclick = ()=>{ div.remove(); persist(); };

      const ta = document.createElement("textarea");
      ta.rows = 2;
      ta.placeholder = t("itemPlaceholder");
      ta.value = val;
      ta.addEventListener("input", ()=> persist());

      div.appendChild(del);
      div.appendChild(ta);
      container.appendChild(div);

      persist();
    }

    function addMeasure(m={text:"", due:"", owner:""}){
      const host = document.getElementById("measuresList");
      const row = document.createElement("div");
      row.className = "measure-item";

      row.innerHTML = `
        <textarea rows="2" placeholder="${escapeHtml(t("measurePlaceholder"))}"></textarea>
        <div>
          <div style="font-size:12px;color:${getCssVar('--muted')};font-weight:800;text-transform:uppercase;margin-bottom:6px;">${escapeHtml(t("dueLabel"))}</div>
          <input type="date" />
        </div>
        <div>
          <div style="font-size:12px;color:${getCssVar('--muted')};font-weight:800;text-transform:uppercase;margin-bottom:6px;">${escapeHtml(t("ownerShort"))}</div>
          <input type="text" placeholder="${escapeHtml(t("ownerShort"))}" />
        </div>
        <button type="button" class="measure-delete" title="${escapeHtml(t("deleteMeasure"))}" aria-label="${escapeHtml(t("deleteMeasure"))}">&times;</button>
      `;

      const ta = row.querySelector("textarea");
      const due = row.querySelector('input[type="date"]');
      const own = row.querySelectorAll('input[type="text"]')[0];
      const del = row.querySelector(".measure-delete");

      ta.value = m.text || "";
      due.value = m.due || "";
      own.value = m.owner || "";

      const onChange = ()=> persist();
      ta.addEventListener("input", onChange);
      due.addEventListener("change", onChange);
      own.addEventListener("input", onChange);

      del.addEventListener("click", ()=>{
        row.remove();
        persist();
      });

      host.appendChild(row);
      applyI18n();
      persist();
    }

    function getMeasures(){
      return Array.from(document.querySelectorAll("#measuresList .measure-item")).map(row=>{
        const ta = row.querySelector("textarea");
        const due = row.querySelector('input[type="date"]');
        const own = row.querySelectorAll('input[type="text"]')[0];
        return { text: ta ? ta.value : "", due: due ? due.value : "", owner: own ? own.value : "" };
      });
    }

    function collectState(){
      const areas = ["PEOPLE","METHODS","RESOURCES","INPUTS","OUTPUTS","RISKS","KPIS","DOCS"];
      const data = {
        lang: currentLang,
        meta: {
          procName: document.getElementById("procName").value,
          procOwner: document.getElementById("procOwner").value,
          procDate: document.getElementById("procDate").value,
          procVersion: document.getElementById("procVersion").value,
          procScope: document.getElementById("procScope").value,
          procPurpose: document.getElementById("procPurpose").value,
          procStart: document.getElementById("procStart").value,
          procEnd: document.getElementById("procEnd").value
        },
        areas: {},
        measures: getMeasures()
      };
      areas.forEach(a=>{
        data.areas[a] = Array.from(document.querySelectorAll(`#notes-${a} textarea`)).map(x=>x.value);
      });
      return data;
    }

    function persist(){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(collectState()));
      }catch(e){}
    }

    function restore(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      try{
        const data = JSON.parse(raw);
        if(!data || typeof data !== "object") return false;

        if(data.lang==="de" || data.lang==="en") currentLang = data.lang;
        applyI18n();

        const m = data.meta || {};
        document.getElementById("procName").value = m.procName || "";
        document.getElementById("procOwner").value = m.procOwner || "";
        document.getElementById("procDate").value = m.procDate || "";
        document.getElementById("procVersion").value = m.procVersion || "";
        document.getElementById("procScope").value = m.procScope || "";
        document.getElementById("procPurpose").value = m.procPurpose || "";
        document.getElementById("procStart").value = m.procStart || "";
        document.getElementById("procEnd").value = m.procEnd || "";

        const areas = ["PEOPLE","METHODS","RESOURCES","INPUTS","OUTPUTS","RISKS","KPIS","DOCS"];
        areas.forEach(a=>{
          const c = document.getElementById(`notes-${a}`);
          c.innerHTML = "";
          ((data.areas && data.areas[a]) || []).forEach(txt=> addItem(a, txt));
        });

        // measures
        const ml = document.getElementById("measuresList");
        ml.innerHTML = "";
        (Array.isArray(data.measures) ? data.measures : []).forEach(mm=> addMeasure(mm));

        return true;
      }catch(e){
        return false;
      }
    }

    function escapeHtml(s){
      return String(s ?? "")
        .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;").replace(/'/g,"&#039;");
    }

    function getCssVar(name){
      return getComputedStyle(document.documentElement).getPropertyValue(name).trim() || "#64748b";
    }

    // Autosave meta fields
    ["procName","procOwner","procDate","procVersion","procScope","procPurpose","procStart","procEnd"].forEach(id=>{
      const el = document.getElementById(id);
      el.addEventListener("input", ()=> persist());
      el.addEventListener("change", ()=> persist());
    });

    // Export PNG
    document.getElementById("btnExport").onclick = ()=>{
      const area = document.getElementById("capture-area");
      html2canvas(area, {scale:2, backgroundColor:"#ffffff"}).then(canvas=>{
        const a = document.createElement("a");
        a.download = t("pngName");
        a.href = canvas.toDataURL("image/png");
        a.click();
      });
    };

    // Print
    document.getElementById("btnPrint").onclick = ()=> window.print();

    // Save JSON
    document.getElementById("btnSave").onclick = ()=>{
      const blob = new Blob([JSON.stringify(collectState(), null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = t("jsonName");
      a.click();
    };

    // Load JSON
    document.getElementById("btnLoad").onchange = (e)=>{
      const file = e.target.files && e.target.files[0];
      if(!file) return;

      const reader = new FileReader();
      reader.onload = (ev)=>{
        try{
          const parsed = JSON.parse(ev.target.result);

          // store to local storage + restore
          localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed));
          restore();
          // ensure language button states
          setLanguage(currentLang);

        }catch(err){
          alert(t("loadError"));
        }
      };
      reader.readAsText(file);

      e.target.value = "";
    };

    // Reset
    document.getElementById("btnReset").onclick = ()=>{
      if(!confirm(t("confirmReset"))) return;
      localStorage.removeItem(STORAGE_KEY);
      location.reload();
    };

    // Language
    document.getElementById("btnLangDE").onclick = ()=> setLanguage("de");
    document.getElementById("btnLangEN").onclick = ()=> setLanguage("en");

    // Measures buttons
    document.getElementById("btnAddMeasure").addEventListener("click", ()=> addMeasure());
    document.getElementById("btnFromRisks").addEventListener("click", ()=>{
      const risks = Array.from(document.querySelectorAll("#notes-RISKS textarea"))
        .map(x=>x.value.trim()).filter(Boolean);
      if(!risks.length) return;
      // avoid duplicates: only add those not already present exactly
      const existing = new Set(getMeasures().map(m=> (m.text||"").trim()).filter(Boolean));
      risks.forEach(r=>{
        if(!existing.has(r)) addMeasure({text:r, due:"", owner:""});
      });
      persist();
    });

    // Footer year
    (function(){
      const el = document.getElementById("copyrightYear");
      if(el) el.textContent = new Date().getFullYear();
    })();

    // Init
    const ok = restore();
    if(!ok){
      setLanguage(currentLang);
      // default date today (optional)
      const d = document.getElementById("procDate");
      if(d && !d.value){
        const now = new Date();
        const iso = new Date(now.getTime() - now.getTimezoneOffset()*60000).toISOString().slice(0,10);
        d.value = iso;
      }
      applyI18n();
      // create one empty measure row by default? (neutral: no)
      persist();
    }else{
      setLanguage(currentLang);
    }
  </script>
</body>
</html>
